<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{layouts/layout1}">
     
   <meta charset="UTF-8">
   
   <div layout:fragment="content" class="content">
      <h2>게시글 상세보기</h2>
      <form th:action="@{/board/update}" method="post" class="mt-4">
         <div class="form-group row">
            <label>번호</label>
            <input type="text" name="bno" class="form-control"
               th:value="${dto.bno}" readonly>
         </div>
         <div class="form-group row">
            <label>제목</label>
            <input type="text" name="title" class="form-control"
               th:value="${dto.title}">
         </div>
         <div class="form-group row">
            <label>내용</label>
            <textarea name="content" rows="5" 
               class="form-control">[[${dto.content}]]</textarea>
         </div>
         <div class="form-group row">
            <label>작성자</label>
            <input type="text" name="writer" class="form-control"
               th:value="${dto.writerName}" readonly>
         </div>
         <div class="form-group row">
            <label>등록일</label>
            <input type="text" name="regDate" class="form-control"
               th:value="${dto.regDate}" readonly>
         </div>
         <a th:href="@{/board/list(page=${requestDto.page},
            type=${requestDto.type}, keyword=${requestDto.keyword})}" class="btn btn-primary">목록</a>
      </form>
      <!-- 댓글영역 -->
      <div>
      	<div class="mt-4">
      		<h5>
      			<span class="badge badge-secondary addReply">Add Reply</span>
      		</h5>
      	
      		<h5><span class="badge badge-secondary replyCount"> Reply Count [[${dto.replyCount}]]</span></h5>
      	</div>
      </div>
      <!-- 댓글 목록 -->
      <div class="list-group replyList">
	      
      </div><!-- 댓 끝 -->
	      <!-- 댓글 편집 모달 -->
	      <div class="modal" tabindex="-1">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title">댓글 편집</h5>
			        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			      </div>
			      <div class="modal-body">
			      	<div class="form-group">
			      		<input type="text" name="text" class="formcontrol" placeholder="Reply Text">
			      	</div>
			      	<div class="form-group">
			      		<input type="text" name="replyer" class="formcontrol" placeholder="Replyer">
			      		<input type="hidden" name="rno" >
			      	</div>
			        
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-secondary close" data-bs-dismiss="modal">Close</button>
			      </div>
			    </div>
			  </div>
			</div>
			<!-- 자바스크립트 영역 -->
			<script th:inline="javascript">
				$(document).ready(function(){
					let bno = [[${dto.bno}]]
					
					//댓글 목록
					let listGroup = $(".replyList");
					
					//날짜 시간 처리
					function formatTime(str){
						let date = new Date(str);
						
						return date.getFullYear()+ '/' + 
							(date.getMonth() + 1) + '/' + 
							date.getDate() + ' ' 
							+date.getHours()
							+ ":" + date.getMinutes();
					}
					
					//댓글 처리 함수
					function loadJSONData(){
						$.getJSON("/replies/board/" + bno , function(arr){
							console.log(arr);
							
							let str = "";
							$(".replyCount").html("Reply Count" + arr.length);
							
							$.each(arr, function(idx, reply){
								console.log(reply);
								str += '<div class="card-body" data-rno="'+ reply.rno + '">'+reply.rno;
								str += '<h5 class ="card-title"> '+ reply.text +'</h5>';
								str += '<h6 class ="card-subtitle mb-2 text-muted">' + reply.replyer + '</h6>'
								str += '<p class="card-text">' + formatTime(reply.regDate) +'</p>' 
								str += '</div>';
							});
							listGroup.html(str);	//댓글 목록
						});
					}//load
					
					//댓글 수 클릭(댓글 목록 보기)
					$(".replyCount").click(function(){
						loadJSONData();	//호출
					});
					
					//댓글 등록 모달 폼
					let modal = $(".modal");
					
					$(".addReply").click(function(){
						modal.modal('show');
					});
					
				});
			</script>
   </div>
</html>